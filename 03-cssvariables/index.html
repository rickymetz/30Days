<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scoped CSS Variables and JS</title>
  <link rel="stylesheet" href="https://unpkg.com/ress/dist/ress.min.css" />
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="container">
    <div id="img-form" class="img-form maintain-ar">
      <div class="img-wrapper">
        <object id="img-src" data="https://source.unsplash.com/random" type="image/png">
          <img src="./img.jpeg">
        </object>
      </div>
      <div id="controls" class="controls">
        <h2>Duotone Generator<h2>
        <h3> Powered by <span class='hl'>CSS</span> & <span class='hl'>JS</span></h3>
        <div>
          <div class="form-group">
            <label for="file">Upload Image:</label>
            <input id="file" type="file" name="file">
          </div>
          <div class="form-group">
            <div class="button-group">
              <button id="new-img-btn" data-filter="default">Get random new image</button>
            </div>
          </div>
          <div class="form-group">
            <label for="zoom">Zoom</label>
            <input id="zoom" type="range" name="zoom" min="0.25" max="1" value="1" step="0.01" list="ticks">
          </div>

          <div class="form-group">
            <label for="spacing">Spacing:</label>
            <input id="spacing" type="range" name="spacing" min="0" max="200" value="10" data-sizing="px">
          </div>

          <div class="form-group">
            <label for="blur">Blur:</label>
            <input id="blur" type="range" name="blur" min="0" max="25" value="0" data-sizing="px">
          </div>

          <div class="form-group">
            <label for="opacity">Image Opacity:</label>
            <input id="opacity" type="range" name="opacity" min="0" max="1" value="1" step="0.01">
          </div>

          <div class="form-group">
            <label for="foreground">Image Color:</label>
            <input id="foreground" type="color" name="foreground" value="#16006f">
          </div>

          <div class="form-group">
            <label for="fg-bled">Image Blend Mode:</label>
            <select id="fg-blend" name="fg-blend">
              <option data-index="1">None (unset)</option>
              <option data-index="2">multiply</option>
              <option data-index="3">screen</option>
              <option data-index="4">overlay</option>
              <option data-index="5">darken</option>
              <option data-index="6" selected>lighten</option>
              <option data-index="7">color-dodge</option>
              <option data-index="8">color-burn</option>
              <option data-index="9">hard-light</option>
              <option data-index="10">soft-light</option>
              <option data-index="11">difference</option>
              <option data-index="12">exclusion</option>
              <option data-index="13">hue</option>
              <option data-index="14">saturation</option>
              <option data-index="15">color</option>
              <option data-index="16">luminosity</option>
            </select>
          </div>

          <div class="form-group">
            <label for="base">Background Color:</label>
            <input id="base" type="color" name="base" value="#f7392b">
          </div>

          <div class="form-group">
            <label for="bg-blend">Background Blend Mode:</label>
            <select id="bg-blend" name="bg-blend">
              <option data-index="1">None (unset)</option>
              <option data-index="2" selected>multiply</option>
              <option data-index="3">screen</option>
              <option data-index="4">overlay</option>
              <option data-index="5">darken</option>
              <option data-index="6">lighten</option>
              <option data-index="7">color-dodge</option>
              <option data-index="8">color-burn</option>
              <option data-index="9">hard-light</option>
              <option data-index="10">soft-light</option>
              <option data-index="11">difference</option>
              <option data-index="12">exclusion</option>
              <option data-index="13">hue</option>
              <option data-index="14">saturation</option>
              <option data-index="15">color</option>
              <option data-index="16">luminosity</option>
            </select>
          </div>
          <div class="form-group">
            <label for="bg-blend">Premade settings:</label>
            <div class="button-group">
              <button class="premade" data-filter="default">Default</button>
              <button class="premade" data-filter="spotify">Spotify</button>
              <button class="premade" data-filter="vintage">Vintage</button>
              <button class="premade" data-filter="blade-runner">Blade Runner</button>
              <button class="premade" data-filter="laworder">Law & Order</button>
            </div>
          </div>
          <div class="form-group inline">
            <input id="toggle-ar" type="checkbox">
            <label for="toggle-ar">Match Viewport Aspect Ratio <kbd data-key="65" class="key">A</kbd></label>
          </div>
          <small data-key="72" class="form-group key">
            Press <kbd>H</kbd> to hide the sidebar (useful for screenshots)
          </small>
        </div>
      </div>
    </div>
  </div>

  <script>
    const inputs = document.querySelectorAll('.controls input');
    const selects = document.querySelectorAll('.controls select');

    function handleUpdate() {
      const suffix = this.dataset.sizing || '';
      document.documentElement.style.setProperty(`--${this.name}`, this.value + suffix);
    }

    inputs.forEach( input => input.addEventListener('change', handleUpdate));
    inputs.forEach( input => input.addEventListener('mousemove', handleUpdate));

    selects.forEach( select => select.addEventListener('change', handleUpdate));

    var element = document.getElementById('img-form');
    var trigger = document.getElementById('toggle-ar'); // or whatever triggers the toggle

    // File upload
    window.addEventListener('load', function() {
      document.querySelector('input[type="file"]').addEventListener('change', function() {
          if (this.files && this.files[0]) {
              var img = document.querySelector('img');  // $('img')[0]
              img.src = URL.createObjectURL(this.files[0]); // set src to file url
              img.onload = imageIsLoaded; // optional onload event listener
          }
      });
    });

    function imageIsLoaded(e){ }

    // toggle sidebar
    var controls = document.getElementById('controls');
    window.addEventListener('keydown', function(e) {
      if (e.key === "h"){
        controls.classList.toggle('hide-sidebar'); // or whatever your active class is
      }else if (e.key === "a") {
        element.classList.toggle('maintain-ar');
        if (trigger.checked === true){
          trigger.checked = false;
        } else {
          trigger.checked = true;
        }
      } else {
        return;
      }
    });

    trigger.addEventListener( 'change', function() {
      element.classList.toggle('maintain-ar'); // or whatever your active class is
    });

    // Premade selections fillings
    const premades = document.querySelectorAll('.controls .premade'); //Fetch all .premade element
    const bg = document.getElementById("base");
    const fg = document.getElementById("foreground");
    const opacity = document.getElementById("opacity");
    const root = document.documentElement;

    function handleClickUpdate(e) {
      e.preventDefault();
      const filter = this.dataset.filter;
      switch (filter) {
        case 'default':
          root.style.setProperty("--base", "#f7392b");
          root.style.setProperty("--foreground", "#16006f");
          root.style.setProperty("--bg-blend", "multiply");
          root.style.setProperty("--fg-blend", "lighten");
          root.style.setProperty("--opacity", "1");
          bg.setAttribute("value", "#f7392b");
          fg.setAttribute("value", "#16006f");
          document.querySelector('#bg-blend [data-index="' + 2 + '"]').selected = true;
          document.querySelector('#fg-blend [data-index="' + 6 + '"]').selected = true;
          opacity.value = 1;
          break;
        case 'spotify':
          root.style.setProperty("--base", "#08b76c");
          root.style.setProperty("--foreground", "#0a3463");
          root.style.setProperty("--bg-blend", "multiply");
          root.style.setProperty("--fg-blend", "lighten");
          root.style.setProperty("--opacity", "1");
          bg.setAttribute("value", "#08b76c");
          fg.setAttribute("value", "#0a3463");
          document.querySelector('#bg-blend [data-index="' + 2 + '"]').selected = true;
          document.querySelector('#fg-blend [data-index="' + 6 + '"]').selected = true;
          opacity.value = 1;
          break;
        case 'vintage':
          root.style.setProperty("--base", "#e9e9d2");
          root.style.setProperty("--foreground", "#514442");
          root.style.setProperty("--bg-blend", "color-burn");
          root.style.setProperty("--fg-blend", "screen");
          root.style.setProperty("--opacity", "0.8");
          bg.setAttribute("value", "#e9e9d2");
          fg.setAttribute("value", "#514442");
          document.querySelector('#bg-blend [data-index="' + 8 + '"]').selected = true;
          document.querySelector('#fg-blend [data-index="' + 3 + '"]').selected = true;
          opacity.value = 0.8;
          break;
        case 'blade-runner':
          root.style.setProperty("--base", "#8c9da4");
          root.style.setProperty("--foreground", "#618cf5");
          root.style.setProperty("--bg-blend", "overlay");
          root.style.setProperty("--fg-blend", "color-burn");
          root.style.setProperty("--opacity", "0.5");
          bg.setAttribute("value", "#8c9da4");
          fg.setAttribute("value", "#618cf5");
          document.querySelector('#bg-blend [data-index="' + 4 + '"]').selected = true;
          document.querySelector('#fg-blend [data-index="' + 8 + '"]').selected = true;
          opacity.value = 0.5;
          break;
        case 'laworder':
          root.style.setProperty("--base", "#000000");
          root.style.setProperty("--foreground", "#c35655");
          root.style.setProperty("--bg-blend", "unset");
          root.style.setProperty("--fg-blend", "color-burn");
          root.style.setProperty("--opacity", "1");
          bg.setAttribute("value", "#000000");
          fg.setAttribute("value", "#c35655");
          opacity.value = 1;
          document.querySelector('#bg-blend [data-index="' + 1 + '"]').selected = true;
          document.querySelector('#fg-blend [data-index="' + 8 + '"]').selected = true;
          break;
        default:
          console.log('Error: No filter found.');
      }
    }
    premades.forEach( premade => premade.addEventListener('click', handleClickUpdate)); //Attach click listener on each premade buttons that triggers function

    // Get new random img
    const img_url = "https://source.unsplash.com/random/";
    const img_element = document.getElementById('img-src');
    const new_img_btn = document.getElementById('new-img-btn');

    new_img_btn.addEventListener('click', function(){

      img_element.setAttribute("data", img_url + (Math.floor(Math.random()*(1000-300+1)+300)));
      // if (img_element.data == img_url) {
      //   img_element.setAttribute("data", img_url + "?");
      // } else {
      //   img_element.setAttribute("data", img_url);
      // }
    });
  </script>

</body>
</html>
