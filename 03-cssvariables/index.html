<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scoped CSS Variables and JS</title>
  <link rel="stylesheet" href="https://unpkg.com/ress/dist/ress.min.css" />
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="container">
    <div id="img-form" class="img-form maintain-ar">
      <div class="img-wrapper">
        <img src="./img.jpeg">
      </div>
      <div id="controls" class="controls">
        <h2>Spotify style Duotone Generator<h2>
        <h3> Powered by <span class='hl'>CSS</span> & <span class='hl'>JS</span></h3>
        <form>
          <div class="form-group">
            <label for="file">Upload Image:</label>
            <input id="file" type="file" name="file">
          </div>
          <div class="form-group">
            <label for="zoom">Zoom</label>
            <input id="zoom" type="range" name="zoom" min="0.25" max="1" value=".9" step="0.01">
          </div>

          <div class="form-group">
            <label for="spacing">Spacing:</label>
            <input id="spacing" type="range" name="spacing" min="0" max="200" value="10" data-sizing="px">
          </div>

          <div class="form-group">
            <label for="blur">Blur:</label>
            <input id="blur" type="range" name="blur" min="0" max="25" value="0" data-sizing="px">
          </div>

          <div class="form-group">
            <label for="opacity">Image Opacity:</label>
            <input id="opacity" type="range" name="opacity" min="0" max="1" value="1" step="0.01">
          </div>

          <div class="form-group">
            <label for="foreground">Image Color:</label>
            <input id="foreground" type="color" name="foreground" value="#16006f">
          </div>

          <div class="form-group">
            <label for="fg-bled">Image Blend Mode:</label>
            <select id="fg-blend" name="fg-blend">
              <option>None (unset)</option>
              <option>multiply</option>
              <option>screen</option>
              <option>overlay</option>
              <option>darken</option>
              <option selected>lighten</option>
              <option>color-dodge</option>
              <option>color-burn</option>
              <option>hard-light</option>
              <option>soft-light</option>
              <option>difference</option>
              <option>exclusion</option>
              <option>hue</option>
              <option>saturation</option>
              <option>color</option>
              <option>luminosity</option>
            </select>
          </div>

          <div class="form-group">
            <label for="base">Background Color:</label>
            <input id="base" type="color" name="base" value="#f7392b">
          </div>

          <div class="form-group">
            <label for="bg-blend">Background Blend Mode:</label>
            <select id="bg-blend" name="bg-blend">
              <option>None (unset)</option>
              <option selected>multiply</option>
              <option>screen</option>
              <option>overlay</option>
              <option>darken</option>
              <option>lighten</option>
              <option>color-dodge</option>
              <option>color-burn</option>
              <option>hard-light</option>
              <option>soft-light</option>
              <option>difference</option>
              <option>exclusion</option>
              <option>hue</option>
              <option>saturation</option>
              <option>color</option>
              <option>luminosity</option>
            </select>
          </div>
          <div class="form-group inline">
            <input id="toggle-ar" type="checkbox">
            <label for="toggle-ar">Match Viewport Aspect Ratio <kbd data-key="65" class="key">A</kbd></label>
          </div>
          <small onmousedown="playSoundClick(this)" data-key="72" class="form-group key">
            Press <kbd>H</kbd> to hide the sidebar (useful for screenshots)
          </small>
        </form>
      </div>
    </div>
  </div>

  <script>
    const inputs = document.querySelectorAll('.controls input');
    const selects = document.querySelectorAll('.controls select');

    function handleUpdate() {
      const suffix = this.dataset.sizing || '';
      document.documentElement.style.setProperty(`--${this.name}`, this.value + suffix);
    }

    inputs.forEach( input => input.addEventListener('change', handleUpdate));
    inputs.forEach( input => input.addEventListener('mousemove', handleUpdate));

    selects.forEach( select => select.addEventListener('change', handleUpdate));

    var element = document.getElementById('img-form');
    var trigger = document.getElementById('toggle-ar'); // or whatever triggers the toggle

    // File upload
    window.addEventListener('load', function() {
      document.querySelector('input[type="file"]').addEventListener('change', function() {
          if (this.files && this.files[0]) {
              var img = document.querySelector('img');  // $('img')[0]
              img.src = URL.createObjectURL(this.files[0]); // set src to file url
              img.onload = imageIsLoaded; // optional onload event listener
          }
      });
    });

    function imageIsLoaded(e){ }

    // toggle sidebar
    var controls = document.getElementById('controls');
    window.addEventListener('keydown', function(e) {
      console.log(e.key);

      if (e.key === "h"){
        controls.classList.toggle('hide-sidebar'); // or whatever your active class is
      }else if (e.key === "a") {
        element.classList.toggle('maintain-ar');
        if (trigger.checked === true){
          trigger.checked = false;
        } else {
          trigger.checked = true;
        }
      } else {
        return;
      }
    });

    trigger.addEventListener( 'change', function() {
      element.classList.toggle('maintain-ar'); // or whatever your active class is
    });
  </script>

</body>
</html>
